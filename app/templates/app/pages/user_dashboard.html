{% extends "base.html" %}

{% block extra_css %}
.sidebar {
    width: 250px;
    background-color: #f8f9fa;
    height: 100vh;
    padding-top: 2rem;
    border-right: 1px solid #dee2e6;
  }
  .sidebar a {
    text-decoration: none;
    color: #333;
  }
  .sidebar a:hover {
    color: #0d6efd;
  }
  .content {
    padding: 2rem;
    overflow-y: auto;
    height: 100vh;
  }
  .section {
    margin-bottom: 3rem;
  }
  .placeholder-box {
    background-color: #e9ecef;
    height: 150px;
    border-radius: 5px;
  }

{% endblock %}

{% block content %}
<div class="d-flex">
    <!-- Bot√≥n hamburguesa solo visible en m√≥viles -->
    <button class="btn btn-outline-secondary d-md-none m-3" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenuMobile" aria-controls="sidebarMenuMobile">
      <i class="bi bi-list"></i> Men√∫
    </button>

    <!-- Sidebar fijo en escritorio -->
    <div class="d-none d-md-block sidebar" style="height: 100%">
      <h4 class="mb-4 px-3">My Profile</h4>
      <ul class="nav flex-column px-3">
        <li class="nav-item mb-2"><a class="nav-link" href="#Purchase">üõí Purchase History</a></li>
        <li class="nav-item mb-2"><a class="nav-link" href="#Comments">üí¨ Comments</a></li>
        <li class="nav-item mb-2"><a class="nav-link" href="#Ratings">‚≠ê Ratings</a></li>
        <li class="nav-item mb-2"><a class="nav-link" href="#Favorites">‚ù§Ô∏è Favorites</a></li>
        <li class="nav-item"><a class="nav-link" href="#information">‚öôÔ∏è User information</a></li>
      </ul>
    </div>

    <!-- Sidebar m√≥vil como offcanvas -->
    <div class="offcanvas offcanvas-start d-md-none" tabindex="-1" id="sidebarMenuMobile">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title">Men√∫</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
      </div>
      <div class="offcanvas-body px-3">
        <ul class="nav flex-column">
          <li class="nav-item mb-2"><a class="nav-link" href="#Purchase">üõí Purchase History</a></li>
          <li class="nav-item mb-2"><a class="nav-link" href="#Comments">üí¨ Comments</a></li>
          <li class="nav-item mb-2"><a class="nav-link" href="#Ratings">‚≠ê Ratings</a></li>
          <li class="nav-item mb-2"><a class="nav-link" href="#Favorites">‚ù§Ô∏è Favorites</a></li>
          <li class="nav-item"><a class="nav-link" href="#information">‚öôÔ∏è User information</a></li>
        </ul>
      </div>
    </div>



    <div class="d-flex" style="height: 80vh; width: 100%">
      <div class="content flex-grow-1" style="padding: 0; height: 80vh">

        <!-- PURCHASE -->
        <div id="Purchase" class="container my-4">
          <h6 class="mb-3 fw-semibold text-primary">Historial de Compras</h6>
          {% if tickets %}
            <div class="row g-3">
              {% for ticket in tickets %}
                <div class="col-12 col-sm-6 col-lg-4">
                  <div class="p-3 border rounded shadow-sm small h-100 d-flex flex-column justify-content-between">
                    <div>
                      <div class="d-flex justify-content-between align-items-center mb-1">
                        <span class="fw-semibold">#{{ ticket.ticket_code }}</span>
                        <small class="text-muted">{{ ticket.buy_date|date:"d M Y, H:i" }}</small>
                      </div>
                      <div class="mb-1">
                        <div><strong>Evento:</strong> {{ ticket.event.title }}</div>
                        <div><strong>Tipo:</strong> {{ ticket.get_type_display }}</div>
                        <div><strong>Cantidad:</strong> {{ ticket.quantity }}</div>
                      </div>
                      <div class="text-muted">
                        <i class="bi bi-check-circle me-1"></i>{{ ticket.get_state_display }}
                      </div>
                    </div>
                    <!-- Bot√≥n Reembolso -->
                    <div class="mt-3 text-end">
                      <button class="btn btn-sm btn-outline-warning" data-bs-toggle="modal" data-bs-target="#refundModal{{ ticket.pk }}">
                        <i class="bi bi-arrow-counterclockwise me-1"></i>Solicitar reembolso
                      </button>
                    </div>
                  </div>
                </div>
        
                <!-- Modal de Reembolso -->
                <div class="modal fade" id="refundModal{{ ticket.pk }}" tabindex="-1" aria-labelledby="refundModalLabel{{ ticket.pk }}" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content rounded-3">
                      <div class="modal-header">
                        <h5 class="modal-title" id="refundModalLabel{{ ticket.pk }}">Solicitar Reembolso</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                      </div>
                      <form method="post">
                        {% csrf_token %}
                        <div class="modal-body">
                          <p class="mb-3">Selecciona el motivo del reembolso para el ticket <strong>#{{ ticket.ticket_code }}</strong>:</p>
                          <div class="mb-3">
                            <label for="reason{{ ticket.pk }}" class="form-label">Motivo</label>
                            <select class="form-select" id="reason{{ ticket.pk }}" name="reason" required>
                              <option value="" selected disabled>Elegir motivo...</option>
                              <option value="event_cancelled">El evento fue cancelado</option>
                              <option value="could_not_attend">No pude asistir</option>
                              <option value="mistaken_purchase">Compra por error</option>
                              <option value="other">Otro</option>
                            </select>
                          </div>
                          <div class="mb-3">
                            <label for="details{{ ticket.pk }}" class="form-label">Detalles adicionales (opcional)</label>
                            <textarea class="form-control" id="details{{ ticket.pk }}" name="details" rows="3"></textarea>
                          </div>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                          <button type="submit" class="btn btn-warning">Enviar solicitud</button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="text-muted fst-italic small">No hay tickets comprados.</div>
          {% endif %}
        </div>
        
        

        

        <!-- COMMENTS -->
        <div id="Comments" class="container my-5">
          <h5 class="mb-4 fw-semibold text-primary">Comentarios</h5>
          <div class="d-flex flex-column gap-4">
            {% if comments %}
              {% for comment in comments %}
                <div class="p-3 border rounded-3 shadow-sm">
                  <div class="d-flex justify-content-between align-items-center mb-1">
                    <span class="fw-semibold">{{ comment.title }}</span>
                    <small class="text-muted">{{ comment.create_at }}</small>
                  </div>
                  <p class="mb-2 text-body">{{ comment.text }}</p>
                  <div class="text-muted small mb-2">
                    <i class="bi bi-calendar-event me-1"></i>Evento: {{ comment.event.title }}<br>
                    <i class="bi bi-geo-alt me-1"></i>Ubicaci√≥n: {{ comment.event.venue.name }}
                  </div>
                  <div class="d-flex gap-2 justify-content-end">
                    <!-- Bot√≥n Editar -->
                    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#editModal{{ comment.pk }}">
                      <i class="bi bi-pencil"></i> Editar
                    </button>
                    <!-- Bot√≥n Eliminar -->
                    <button class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ comment.pk }}">
                      <i class="bi bi-trash"></i> Eliminar
                    </button>
                  </div>
                </div>
        
                <!-- Modal Editar -->
                <div class="modal fade" id="editModal{{ comment.pk }}" tabindex="-1" aria-labelledby="editModalLabel{{ comment.pk }}" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content rounded-3">
                      <div class="modal-header">
                        <h5 class="modal-title" id="editModalLabel{{ comment.pk }}">Editar Comentario</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                      </div>
                      <form method="post">
                        {% csrf_token %}
                        <div class="modal-body">
                          <div class="mb-3">
                            <label for="title{{ comment.pk }}" class="form-label">T√≠tulo</label>
                            <input type="text" class="form-control" name="title" id="title{{ comment.pk }}" value="{{ comment.title }}">
                          </div>
                          <div class="mb-3">
                            <label for="text{{ comment.pk }}" class="form-label">Comentario</label>
                            <textarea class="form-control" name="text" id="text{{ comment.pk }}" rows="3">{{ comment.text }}</textarea>
                          </div>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                          <button type="submit" class="btn btn-primary">Guardar cambios</button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
        
                <!-- Modal Eliminar -->
                <div class="modal fade" id="deleteModal{{ comment.pk }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ comment.pk }}" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-3">
                      <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalLabel{{ comment.pk }}">Confirmar eliminaci√≥n</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                      </div>
                      <div class="modal-body">
                        ¬øEst√°s seguro de que deseas eliminar este comentario?
                      </div>
                      <div class="modal-footer">
                        <form method="post">
                          {% csrf_token %}
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                          <button type="submit" class="btn btn-danger">Eliminar</button>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
        
              {% endfor %}
            {% else %}
              <div class="text-muted fst-italic">No hay comentarios a√∫n.</div>
            {% endif %}
          </div>
        </div>
        

        
        
        
        <div id="Ratings" class="section">
          <h5 class="mb-4 fw-semibold text-primary">Ratings</h5>
        </div>
        <div id="Favorites" class="section">
          <h5 class="mb-4 fw-semibold text-primary">Favorites</h5>
        </div>
        <div id="information" class="section">
              <h5 class="mb-4 fw-semibold text-primary">User information</h5>
        </div>
      </div>
    </div>
</div>
{% endblock content %}